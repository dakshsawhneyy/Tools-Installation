FROM python:3.10-slim AS builder

# Set up Environment Variable
ENV VIRTUAL_ENV=/app/venv
ENV PATH="$VIRTUAL_ENV/bin:$PATH"

WORKDIR /app
COPY requirements.txt .

RUN pip install -r requirements.txt
COPY app.py .

# Stage 2
FROM gcr.io/distroless/python3-debian11
WORKDIR /app

# virtual env inside container
ENV VIRTUAL_ENV=/app/venv
ENV PATH="$VIRTUAL_ENV/bin:$PATH"

COPY --from=builder $VIRTUAL_ENV $VIRTUAL_ENV
COPY --from=builder /app/app.py .

EXPOSE 5000

CMD ["python", "app.py"]
